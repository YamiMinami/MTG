<%- include("partials/header") %>

    <body>
        <%- include("partials/aside") %>
            <main id="deck-container">
                <section id="deck-bar">
                    <!-- Zoekformulier -->
                    <form method="GET" action="/deckbuilder" class="search-form">
                        <input id="deck-search" type="search" name="search" placeholder="Zoek decks..."
                            value="<%= searchQuery %>">
                        <input type="hidden" name="mana" value="<%= currentFilter %>">
                    </form>

                    <!-- Mana filters -->
                    <section id="deck-manabar">
                        <% ['None', 'White' , 'Blue' , 'Black' , 'Red' , 'Green' ].forEach(color=> { %>
                            <form method="GET" action="/deckbuilder" style="display: inline;">
                                <input type="hidden" name="search" value="<%= searchQuery %>">
                                <input type="hidden" name="mana" value="<%= color %>">
                                <button type="submit" class="deck-type <%= currentFilter === color ? 'active' : '' %>">
                                    <img src="/assets/A_fantasy-style_<%= color.toLowerCase() %>_mana_symbol_from_Magic__The__transparent.png"
                                        alt="<%= color %>">
                                </button>
                            </form>
                            <% }); %>
                    </section>

                    <button id="add-deck-button" class="deck-buttons">
                        <strong>deck toevoegen</strong>
                    </button>
                </section>

                <!-- Flash messages -->
                <% if (message) { %>
                    <div class="flash-message <%= message.type %>">
                        <%= message.message %>
                    </div>
                    <% } %>

                        <section id="deck-collection">
                            <% decks.forEach(deck=> { %>
                                <article class="deck-card">
                                    <img src="/assets/<%= deck.image || 'Deck' + Math.floor(Math.random() * 5 + 1) + '.jpg' %>"
                                        alt="<%= deck.name %>">
                                    <div class="deck-info">
                                        <h2>
                                            <%= deck.name %>
                                        </h2>
                                        <div class="deck-meta">
                                            <% deck.colors.forEach(color=> { %>
                                                <img src="/assets/A_fantasy-style_<%= color.toLowerCase() %>_mana_symbol_from_Magic__The__transparent.png"
                                                    alt="<%= color %>" class="mana-icon">
                                                <% }); %>
                                                    <span class="card-count">
                                                        <%= deck.cards.length %>/20
                                                    </span>
                                        </div>
                                        <div class="deck-actions">
                                            <a href="/deck/<%= deck._id %>/edit" class="btn edit-btn">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            <form action="/deck/<%= deck._id %>" method="POST">
                                                <input type="hidden" name="_method" value="DELETE">
                                                <button type="submit" class="btn delete-btn">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </article>
                                <% }); %>
                        </section>

                        <!-- Modal voor nieuwe decks -->
                        <div id="deck-modal" class="modal">
                            <div class="modal-content">
                                <span class="close">&times;</span>
                                <form id="deck-form" action="/deck" method="POST">
                                    <h2>Nieuw Deck</h2>
                                    <div class="form-group">
                                        <label for="deck-name">Deck Naam</label>
                                        <input type="text" id="deck-name" name="name" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Mana Kleuren</label>
                                        <div class="color-grid">
                                            <% ['White', 'Blue' , 'Black' , 'Red' , 'Green' , 'None' ].forEach(color=> {
                                                %>
                                                <label class="color-option">
                                                    <input type="checkbox" name="colors" value="<%= color[0] %>">
                                                    <img src="/assets/A_fantasy-style_<%= color.toLowerCase() %>_mana_symbol_from_Magic__The__transparent.png"
                                                        alt="<%= color %>">
                                                </label>
                                                <% }); %>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn-primary">Aanmaken</button>
                                </form>
                            </div>
                        </div>

                        <!-- Paginering -->
                        <section class="pages">
                            <form method="GET" class="pagination-form">
                                <input type="hidden" name="search" value="<%= searchQuery %>">
                                <input type="hidden" name="mana" value="<%= currentFilter %>">
                                <button type="submit" name="page" value="<%= currentPage - 1 %>"
                                    class="pagination-button" <%=currentPage <=1 ? 'disabled' : '' %>>
                                    Terug
                                </button>
                            </form>

                            <span class="pagination-info">Pagina <%= currentPage %> van <%= totalPages %></span>

                            <form method="GET" class="pagination-form">
                                <input type="hidden" name="search" value="<%= searchQuery %>">
                                <input type="hidden" name="mana" value="<%= currentFilter %>">
                                <button type="submit" name="page" value="<%= currentPage + 1 %>"
                                    class="pagination-button" <%=currentPage>= totalPages ? 'disabled' : '' %>>
                                    Volgende
                                </button>
                            </form>
                        </section>
            </main>
    </body>

    </html>